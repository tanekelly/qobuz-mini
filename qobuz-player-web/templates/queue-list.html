@defer (list.html) {
  <form
    class="sortable overflow-hidden"
    hx-put="/api/queue/reorder"
    hx-trigger="end"
    hx-swap="none"
  >
    @for (track in tracks) {
      @defer (list-item.html) {
        <div
          class="flex scroll-m-48 justify-between bg-black"
          id="@if(track.status == 'Playing') {playing} @else {{{track.id}}}"
        >
          <button
            hx-swap="none"
            hx-put="/api/skip-to/{{ index }}"
            class="@if(track.status != 'Unplayed' && track.status != 'Playing'){opacity-40 } flex w-full cursor-pointer items-center gap-4 overflow-hidden text-left disabled:cursor-default disabled:text-gray-500"
            @if(!track.available){disabled}
          >
            <div class="flex size-12 items-center justify-center">
              <div class="relative size-12 overflow-hidden rounded-md">
                <div
                  class="@if(index == currently_playing_position) {opacity-40 } h-full w-full rounded-md bg-gray-800 bg-cover bg-center bg-no-repeat"
                  style="background-image: url({{ track.image }});"
                ></div>

                @if (index == currently_playing_position) {
                  <div
                    class="absolute inset-0 grid place-items-center text-blue-500"
                  >
                    <span class="size-6">
                      <svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="-10 0 970 1024" width="100%" height="100%">
                        <g transform="matrix(1 0 0 -1 0 960)">
                          <path fill="currentColor" d="M31 910v-924q0 -21 14.5 -35.5t35.5 -14.5q6 0 12.5 1.5t12.5 5.5l798 462q18 10 23.5 30t-5.5 38q-3 6 -7.5 10.5t-10.5 7.5l-798 462q-18 11 -38 5.5t-30 -23.5q-4 -6 -5.5 -12t-1.5 -13v0z" />
                        </g>
                      </svg>
                    </span>
                  </div>
                }
              </div>
            </div>

            @if (track.artist_name) {
              <div class="flex flex-col overflow-hidden">
                <h2 class="truncate">{{ track.title }}</h2>
                <h3 class="truncate text-sm text-gray-400">
                  {{ track.artist_name }}
                </h3>
                @defer (
                  info.html;
                  hires_available=track.hires_available;
                  explicit=track.explicit
                ) {}
              </div>
            } @else {
              <div class="flex flex-col overflow-hidden">
                <h2 class="w-full truncate">{{ track.title }}</h2>
                @defer (
                  info.html;
                  hires_available=track.hires_available;
                  explicit=track.explicit
                ) {}
              </div>
            }
          </button>

          <div class="flex items-center">
            <button class="button" hx-put="/api/remove-queue-item/{{ index }}">
              @defer (icons/x-circle.html) {}
            </button>

            <input type="hidden" name="new_order" value="{{ index }}" />
            <span class="handle button">
              @defer (icons/bars-2.html) {}
            </span>
          </div>
        </div>
      }
    }
  </form>
}
<script>
  const el = document.getElementById("playing");
  if (el) {
    el.scrollIntoView({ behavior: "smooth", block: "start" });
  }
</script>

<div
  id="settings-content"
  class="flex flex-col gap-8"
  hx-get="/settings/partial"
  hx-trigger="device from:body"
  data-sse="device"
  hx-target="this"
  hx-swap="outerHTML"
>
  <div
    id="title"
    class="sticky top-0 flex max-h-full grow flex-col gap-4 bg-black/80 backdrop-blur"
  >
    <h1 class="text-2xl">Settings</h1>
  </div>

  <div class="mx-auto w-full max-w-md flex flex-col gap-8">
    <div class="flex flex-col gap-2">
      <label class="text-sm font-medium">Audio Output</label>
      <form
        hx-post="/settings/set-device"
        hx-target="#settings-content"
        hx-swap="outerHTML"
        class="flex flex-col gap-2"
      >
        <select
          name="device_name"
          class="w-full px-3 py-2 bg-gray-800 text-gray-100"
          onchange="this.form.requestSubmit()"
        >
          @if (selected_device_name == "") {
            <option value="" selected class="text-gray-100">Default</option>
          } @else {
            <option value="" class="text-gray-100">Default</option>
          }
          @for (device in devices) {
            @if (selected_device_name == device.name) {
              <option value="{{ device.name }}" selected class="text-gray-100">{{ device.name }}</option>
            } @else {
              <option value="{{ device.name }}" class="text-gray-100">{{ device.name }}</option>
            }
          }
        </select>
      </form>
    </div>

    <div class="flex flex-col gap-2">
      <label class="text-sm font-medium">Search default</label>
      <form
        hx-post="/settings/set-preferred-genre"
        hx-target="#settings-content"
        hx-swap="outerHTML"
        class="flex flex-col gap-2"
      >
        <select
          name="preferred_genre_id"
          class="w-full px-3 py-2 bg-gray-800 text-gray-100"
          onchange="this.form.requestSubmit()"
        >
          <option value="" @if (is_discover) { selected } class="text-gray-100">Discover</option>
          @for (genre in genres) {
            <option value="{{ genre.id }}" @if (preferred_genre_id == genre.id) { selected } class="text-gray-100">{{ genre.name }}</option>
          }
        </select>
      </form>
    </div>

    <div class="flex flex-col gap-2">
      <label class="text-sm font-medium">Play rate</label>
      <form
        hx-post="/settings/set-time-stretch"
        hx-target="#settings-content"
        hx-swap="outerHTML"
        class="flex flex-col gap-2"
      >
        <input
          type="range"
          name="time_stretch_ratio"
          min="0.5"
          max="2"
          step="0.1"
          value="{{ time_stretch_ratio_display }}"
          class="w-full settings-slider"
        />
        <span class="text-sm text-gray-400 settings-slider-preview">{{ time_stretch_ratio_display }}x</span>
      </form>
    </div>

    <div class="flex flex-col gap-2">
      <label class="text-sm font-medium">Pitch (semitones)</label>
      <form
        hx-post="/settings/set-pitch"
        hx-target="#settings-content"
        hx-swap="outerHTML"
        class="flex flex-col gap-2"
      >
        <input
          type="range"
          name="pitch_semitones"
          min="-12"
          max="12"
          step="1"
          value="{{ pitch_semitones }}"
          class="w-full settings-slider"
        />
        <span class="text-sm text-gray-400 settings-slider-preview">{{ pitch_semitones }} semitones</span>
      </form>
    </div>

    <div class="flex flex-col gap-2">
      <label class="text-sm font-medium">Pitch (cents)</label>
      <form
        hx-post="/settings/set-pitch-cents"
        hx-target="#settings-content"
        hx-swap="outerHTML"
        class="flex flex-col gap-2"
      >
        <input
          type="range"
          name="pitch_cents"
          min="-100"
          max="100"
          step="1"
          value="{{ pitch_cents }}"
          class="w-full settings-slider"
        />
        <span class="text-sm text-gray-400 settings-slider-preview">{{ pitch_cents }} cents</span>
      </form>
    </div>

    <form hx-post="/settings/sign-out" hx-swap="none" class="flex flex-col gap-4">
      <button type="submit" class="button button-danger w-full">
        <span class="size-6">@defer (icons/user.html) {}</span>
        <span>Sign Out</span>
      </button>
    </form>
  </div>
</div>
